<html>

<head>
    <title>Userme Demo - TATLM - Login</title>
    <link rel="icon" href="data:;base64,=">
    <script src="/env.js"></script>
    <script src="/auth.js"></script>
</head>

<body>
    <h2>TATLM (The Awesome TODO List Manager)</h2>

    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous"
        src="https://connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v7.0&appId=884133135440365&autoLogAppEvents=1"></script>

    <br />
    <h3>Login with email/password</h3>
    <form action="#">
        <label for="email">E-mail:</label><input id="email" type="text" /><br/>
        <label for="password">Password:</label><input id="password" type="password" /><br/>
        <button onclick="loginClick()">Login</button>
    </form>
    <a href="/password-reset.html">Password Reset</a>
    <a href="/account-new.html">Create New Account</a>

    <br />
    <br />
    <h3>Login with Facebook</h3>
    <fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
    </fb:login-button>

    <!-- <div class="fb-login-button" data-size="large" data-button-type="login_with" data-layout="rounded" data-auto-logout-link="false" data-use-continue-as="false" data-width=""></div> -->

    <script>
        // window.fbAsyncInit = function () {
        //     FB.init({
        //         appId: '{your-app-id}',
        //         cookie: true,
        //         xfbml: true,
        //         version: '{api-version}'
        //     });
        //     FB.AppEvents.logPageView();
        // };

        // (function (d, s, id) {
        //     var js, fjs = d.getElementsByTagName(s)[0];
        //     if (d.getElementById(id)) { return; }
        //     js = d.createElement(s); js.id = id;
        //     js.src = "https://connect.facebook.net/en_US/sdk.js";
        //     fjs.parentNode.insertBefore(js, fjs);
        // }(document, 'script', 'facebook-jssdk'));


        // FB.getLoginStatus(function (response) {
        //     // statusChangeCallback(response);
        //     alert(response.status)
        //     // {
        //     //     status: 'connected',
        //     //     authResponse: {
        //     //         accessToken: '...',
        //     //         expiresIn:'...',
        //     //         signedRequest:'...',
        //     //         userID:'...'
        //     //     }
        //     // }
        // });

        // FB.login(function(response) {
        //     if (response.status === 'connected') {
        //         // Logged into your webpage and Facebook.
        //     } else {
        //         // The person is not logged into your webpage or we are unable to tell. 
        //     } 
        // }, {scope: 'public_profile,email'});
        function checkLoginState() {
            FB.getLoginStatus(function (response) {
                // statusChangeCallback(response);
                alert(response.status)
                alert(response.authResponse.accessToken)
            });
        }

        const loginClick = async () => {
            let email = document.getElementById("email").value
            let password = document.getElementById("password").value
            err = await createToken(email, password)
            const token = getToken()
            if(err==null && token!=null) {
                window.location.href = "/"
            } else {
                alert(err)
            }
        }
    </script>

    <p><a href="/">Go to home</a></p>

</body>

</html>