<html>

<head>
    <title>Userme Demo - TATLM - Login</title>
    <link rel="icon" href="data:;base64,=">
    <script src="/env.js"></script>
    <script src="/auth.js"></script>

    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="339086941381-61h3t55u99n9rt0arqmu655cvs3gk3ol.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>    
</head>

<body>
    <h2>TATLM (The Awesome TODO List Manager)</h2>

    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous"
        src="https://connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v7.0&appId=884133135440365&autoLogAppEvents=1"></script>

    <br />
    <h3>Login with email/password</h3>
    <form action="#">
        <label for="email">E-mail:</label><input id="email" type="text" /><br/>
        <label for="password">Password:</label><input id="password" type="password" /><br/>
        <button onclick="loginPasswordClick()">Login</button>
    </form>
    <a href="/password-reset.html">Password Reset</a>
    <a href="/account-new.html">Create New Account</a>

    <br />
    <br />
    <h3>Login with Facebook</h3>
    <fb:login-button size="medium" scope="public_profile,email" onlogin="checkFBLogin()">
    </fb:login-button>

    <br />
    <br />
    <h3>Login with Google</h3>
    <div class="g-signin2" data-onsuccess="onLoginGoogle" data-theme="dark"></div>

    <script>
        const onLoginGoogle = parei aqui(googleUser) => {
            console.log("Login with Google")
            var profile = googleUser.getBasicProfile();
            var googleToken = googleUser.getAuthResponse().id_token
            console.log("Google token=" + googleToken)
            // err = await createTokenGoogle(googleToken)
            // const token = getToken()
            // if(err==null && token!=null) {
            //     window.location.href = "/"
            // } else {
            //     alert(err)
            // }
        }

        function checkFBLogin() {
            FB.getLoginStatus(async (response) => {
                if(response.status == "connected") {
                    err = await createTokenFacebook(response.authResponse.accessToken)
                    const token = getToken()
                    if(err==null && token!=null) {
                        window.location.href = "/"
                    } else {
                        alert(err)
                    }
                }
            });
        }

        const loginPasswordClick = async () => {
            let email = document.getElementById("email").value
            let password = document.getElementById("password").value
            err = await createTokenPassword(email, password)
            const token = getToken()
            if(err==null && token!=null) {
                window.location.href = "/"
            } else {
                alert(err)
            }
        }
    </script>

    <p><a href="/">Go to home</a></p>

</body>

</html>